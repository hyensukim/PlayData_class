# 5. ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ê°œë³„ ê¸°ëŠ¥ ê°œë°œ

spring 5ë²„ì „ ë¶€í„° mapping urlì— '/' ìƒëµ

idë¥¼ PKë¡œ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì „ëµì„ GenerationType.UUID ì‚¬ìš©

- ì´ìœ  : DB ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ëŠ” ê²½ìš°, PK ìˆ«ìê°’ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì‚¬ìš©í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤.

ModelMapper í™•ì¸

Test ì½”ë“œë¥¼ ì§œëŠ” ì´ìœ ëŠ” Controller êµ¬í˜„í•˜ê¸° ì „ê¹Œì§€ ì„œë²„ ë‚´ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

ì¶”ì²œ ë„ì„œ : ë‹¨ìœ„ í…ŒìŠ¤íŠ¸, í…ŒìŠ¤íŠ¸ ì£¼ë„ ê°œë°œ

ResponseEntityë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” íŠ¹ì • ìƒíƒœ ì½”ë“œë¥¼ ì œì–´í•˜ê³  ì‹¶ì€ ê²½ìš°ì— ì‚¬ìš©í•˜ëŠ” ê°ì²´

## ğŸ‡ íšŒì› ì„œë¹„ìŠ¤ (ì¶”ê°€)

íšŒì› ì •ë³´ ì¡°íšŒ ì‹œ, ì£¼ë¬¸ ë‚´ì—­ê¹Œì§€ í•¨ê»˜ ì¡°íšŒë˜ë„ë¡ í•´ì•¼í•œë‹¤.

```
List<Order> orderList;

```

ìœ„ ë‚´ìš©ì„ ì—°ê´€ê´€ê³„ë¡œ ì¶”ê°€í•´ì•¼ í•œë‹¤.

OrderListë¥¼ ë”°ë¡œ ì–»ì–´ì™€ì„œ RespnseDTOì— ìš°ì„  ë„£ì–´ì£¼ëŠ” ë°©í–¥ìœ¼ë¡œ ì§„í–‰í•˜ë©´ ëœë‹¤.

## ğŸ‡ ìƒí’ˆ ì„œë¹„ìŠ¤

### ê¸°ë³¸ ì„¤ì •

##### application.yml

```
server:
  port: 0

spring:
  application:
    name: item-service
  datasource:
    driver-class-name: ${driver-class-name}
    url: ${url}
    username: ${username_}
    password: ${password}
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        format_sql: true
  profiles:
    active: db


eureka:
  client:
    fetch-registry: true # ë™ê¸°ì ìœ¼ë¡œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë“¤ê³¼ í†µì‹  ì—¬ë¶€
    register-with-eureka: true #ìœ ë ˆì¹´ ì„œë²„ì— í´ë¼ì´ì–¸íŠ¸ ë“±ë¡ ì—¬ë¶€
    service-url:
      default-zone: http://127.0.0.1:8761/eureka
  instance:
    instance-id:${spring.application.name}:${spring.application.instance-id:${random.value}}
```

*db ê´€ë ¨ ì„¤ì •ë“¤ì€ application-db ë¼ëŠ” í”„ë¡œí•„ì— ë³„ë„ë¡œ ë¯¼ê° ì •ë³´ë¥¼ ì €ì¥í•œ ìƒíƒœì´ë‹¤.

- ìœ ë ˆì¹´ ì„œë²„ ë“±ë¡
- ëœë¤ í¬íŠ¸ ì§€ì • ì„¤ì •
- db ì—°ë™
- jpa ì„¤ì •

### Item Entitiy

```
import jakarta.persistence.*;
import lombok.*;

@Entity
@Table(name="item")
@Getter @NoArgsConstructor
@AllArgsConstructor @Builder
public class Item {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String productId;
    private String productName;
    private Long stock;
    private Long pricePerItem;

}

```

### ItemRepository

```
import com.playdata.itemservice.domain.Item;
import org.springframework.data.jpa.repository.JpaRepository;

public interface ItemRepository extends JpaRepository<Item,Long> {
    Item findByProductId(String uuid);
}
```

### ItemService

```
import com.playdata.itemservice.domain.Item;
import com.playdata.itemservice.dto.RequestCreateItemDto;
import com.playdata.itemservice.dto.ResponseItemDto;
import com.playdata.itemservice.repository.ItemRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.Optional;

@Service
@RequiredArgsConstructor
public class ItemService {
    private final ItemRepository itemRepository;

    public void createItem(RequestCreateItemDto dto){
        itemRepository.save(dto.toEntity());
    }

    public List<Item> findItems(){
        return itemRepository.findAll();
    }

    public ResponseItemDto findItemById(String uuid){
        Item item = itemRepository.findByProductId(uuid);
        Optional.ofNullable(item).orElseThrow(()->{
            throw new RuntimeException("ë“±ë¡ ë˜ì§€ ì•Šì€ ë¬¼í’ˆ ì…ë‹ˆë‹¤.");
        });
        ResponseItemDto dto = new ResponseItemDto(item);
        return dto;
    }
}

```

### DTO

##### RequestCreateItemDto

```
import com.playdata.itemservice.domain.Item;
import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;

import java.util.UUID;

@Getter @Setter @AllArgsConstructor
@NoArgsConstructor
public class RequestCreateItemDto {
    private String productName;
    private Long stock;
    private Long pricePerItem;

    public Item toEntity(){
        return Item.builder()
                .productId(UUID.randomUUID().toString())
                .productName(this.productName)
                .stock(this.stock)
                .pricePerItem(this.pricePerItem)
                .build();
    }
}
```

### ResponseItemDto

```
import com.playdata.itemservice.domain.Item;
import lombok.*;

@Getter @Setter @NoArgsConstructor @AllArgsConstructor
@Builder
public class ResponseItemDto {
    private String productId;
    private String productName;
    private Long stock;
    private Long pricePerItem;
    private String userId;
    private String orderId;

    public ResponseItemDto(Item item){
        productId = item.getProductId();
        productName = item.getProductName();
        stock = item.getStock();
        pricePerItem = item.getPricePerItem();
    }
}
```

### ItemController

```
import com.playdata.itemservice.domain.Item;
import com.playdata.itemservice.dto.RequestCreateItemDto;
import com.playdata.itemservice.dto.ResponseItemDto;
import com.playdata.itemservice.service.ItemService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("item-service")
@RequiredArgsConstructor
public class ItemController {

    private final ItemService itemService;

    @GetMapping("health-check")
    public String checkHealth(){
        return "server is available!!";
    }

    @PostMapping("items")
    public ResponseEntity<String> registerItem(@RequestBody RequestCreateItemDto dto){
        itemService.createItem(dto);
        return ResponseEntity.status(201).body("ì•„ì´í…œ ë“±ë¡ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤.");
    }

    @GetMapping("items/all")
    public ResponseEntity<List<Item>> getAllItems(){
        List<Item> itemList = itemService.findItems();
        return ResponseEntity.status(200).body(itemList);
    }

    @GetMapping("items/{uuid}")
    public ResponseEntity<ResponseItemDto> getOne(@PathVariable String uuid){
        ResponseItemDto dto = itemService.findItemById(uuid);
        return ResponseEntity.status(200).body(dto);
    }
}
```

## ğŸ‡ ì£¼ë¬¸ ì„œë¹„ìŠ¤

### ê¸°ë³¸ ì„¤ì •

##### application.yml

```
server:
  port: 0

spring:
  application:
    name: item-service
  datasource:
    driver-class-name: ${driver-class-name}
    url: ${url}
    username: ${username_}
    password: ${password}
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        format_sql: true
  profiles:
    active: db


eureka:
  client:
    fetch-registry: true # ë™ê¸°ì ìœ¼ë¡œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë“¤ê³¼ í†µì‹  ì—¬ë¶€
    register-with-eureka: true #ìœ ë ˆì¹´ ì„œë²„ì— í´ë¼ì´ì–¸íŠ¸ ë“±ë¡ ì—¬ë¶€
    service-url:
      default-zone: http://127.0.0.1:8761/eureka
  instance:
    instance-id:${spring.application.name}:${spring.application.instance-id:${random.value}}
```

*db ê´€ë ¨ ì„¤ì •ë“¤ì€ application-db ë¼ëŠ” í”„ë¡œí•„ì— ë³„ë„ë¡œ ë¯¼ê° ì •ë³´ë¥¼ ì €ì¥í•œ ìƒíƒœì´ë‹¤.

- ìœ ë ˆì¹´ ì„œë²„ ë“±ë¡
- ëœë¤ í¬íŠ¸ ì§€ì • ì„¤ì •
- db ì—°ë™
- jpa ì„¤ì •

### Order Entity

```
import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;
import org.springframework.data.annotation.CreatedDate;

import java.time.LocalDateTime;

@Entity
@Table(name="orders")
@Getter @NoArgsConstructor @AllArgsConstructor
@Builder
public class Order {
    @Id @GeneratedValue(strategy= GenerationType.IDENTITY)
    private Long id;

    private String orderId;

    private Long count;

@CreatedDate
    @Column(updatable = false)
    private LocalDateTime createdAt;

String userId;
String productId;
}
```


### OderRepository

```
import com.playdata.orderservice.domain.Order;
import org.springframework.data.jpa.repository.JpaRepository;

public interface OrderRepository extends JpaRepository<Order,Long> {

}
```


### OrderService

```
import com.playdata.orderservice.dto.RequestCreateOrderDto;
import com.playdata.orderservice.repository.OrderRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
public class OrderService {
    private final OrderRepository orderRepository;

    public void createOrder(RequestCreateOrderDto dto){
        orderRepository.save(dto.toEntity());
}
}
```


### DTO

##### RequestCreateOrderDto

```
import com.playdata.orderservice.domain.Order;
import lombok.*;

import java.time.LocalDateTime;
import java.util.UUID;

@Getter @Setter @NoArgsConstructor
@AllArgsConstructor @Builder
public class RequestCreateOrderDto {

    private String orderId;
    private Long count;
    private LocalDateTime createdAt;

String userId;
String productId;

    public Order toEntity(){
        return Order.builder()
                .count(this.count)
                .orderId(UUID.randomUUID().toString())
                .userId(this.userId)
                .productId(this.productId)
                .build();
}
}
```


### OrderController

```
import com.playdata.orderservice.dto.RequestCreateOrderDto;
import com.playdata.orderservice.service.OrderService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("order-service")
@RequiredArgsConstructor
public class OrderController {

    private final OrderService orderService;

@GetMapping("health-check")
    public String healthCheck(){
        return "order-service server is available";
}

    @PostMapping("orders")
    public ResponseEntity<String> create(@RequestBody RequestCreateOrderDto requestCreateOrderDto){
        orderService.createOrder(requestCreateOrderDto);
        return ResponseEntity.status(HttpStatus.CREATED).body("ì£¼ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."); //201
}
}
```


# Git-flow

êµ¬ì„±ì› ë³„ë¡œ ë¸Œë Œì¹˜ë¥¼ ë§Œë“¤ì–´ì„œ í”„ë¡œì íŠ¸ ì§„í–‰

ì „ëµì„ ì§œëŠ” ì´ìœ ? Conflictë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•¨ = ì´ë¥¼ ìµœëŒ€í•œ ì œì–´í•˜ê¸° ìœ„í•´ ì‚¬ìš©

Git-Flowë¥¼ ì‚¬ìš©í•œ ì´ìœ  : ê°œë°œ ì¸ì›ì´ ë§ì•„ì ¸ì„œ ì´ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•¨

## Git-flow ì „ëµ

master(main) - ì œí’ˆìœ¼ë¡œ ì¶œì‹œë  ìˆ˜ ìˆëŠ” ë¸Œë Œì¹˜

develop - ë‹¤ìŒìœ¼ë¡œ ì¶œì‹œí•  ë²„ì „ì„ ê°œë°œí•˜ëŠ” ë¸Œë Œì¹˜

feature - ê¸°ëŠ¥ì„ ê°œë°œí•˜ëŠ” ë¸Œëœì¹˜(issues ê¸°ëŠ¥ì„ ì‚¬ìš©)

pull request ê¸°ëŠ¥ìœ¼ë¡œ ê´€ë¦¬ - ì½”ë“œ ë¦¬ë·°ë¥¼ ë‚¨ê¸°ê¸° ìœ„í•¨

1. dev branch -> issues íƒ­ì— ì¶”ê°€
2. issues íƒ­ì— ë¯¸ë¦¬ ì •í•œ To-Do-Listë¥¼ ì¶”ê°€(Zira, Splint)
3. í˜„ì¬ dev ë¸Œë Œì¹˜ë¥¼ ê¸°ì¤€ feature ë¸Œë Œì¹˜ë¥¼ ë”°ì˜¨ë‹¤
4. ì‘ì—… ì™„ë£Œ í›„ pull Requestë¥¼ ìš”ì²­í•¨.
5. pull Request ëœ ì½”ë“œì— ëŒ€í•œ ì½”ë“œ ë¦¬ë·°í•¨.
6. ë¦¬ë·°ê°€ ëë‚˜ë©´, devì— í•©ì¹¨
7. issues íƒ­ì„ closeí•œ ë’¤ í•´ë‹¹ feature ë¸Œë Œì¹˜ë¥¼ ì‚­ì œ

ì¶”ê°€ë¡œ, ë¸Œë Œì¹˜ ë³´í˜¸ ì •ì±…ì„ í†µí•´ masterì— push ë˜ëŠ” ê²ƒì„ ë°©ì§€

## Git-flow í…ŒìŠ¤íŠ¸

ê°€ìƒ ì—­í•  : Controller ì½”ë”©

`checkout` : ë¸Œë Œì¹˜ ê°„ ì´ë™ | ì»¤ë°‹ ë‚´ì—­ ê°„ ì´ë™

- ex) git checkout -b ë¸Œë Œì¹˜ëª…, git checkout ì»¤ë°‹id

`git -help` : ê¹ƒ ê´€ë ¨ ëª…ë ¹ì–´ í™•ì¸


### ğŸ˜ƒí˜‘ì—… ì‹œ ê¹ƒí—™ ì‚¬ìš© ê³¼ì •

1. gitHubì— ì‘ì—…í•  ì´ìŠˆ ìƒì„±(#ë²ˆí˜¸)
2. ë¡œì»¬ ë ˆí¬ì§€í† ë¦¬ì—ì„œ develop ë¸Œë Œì¹˜ pull
3. feature#ë²ˆí˜¸ ë¸Œë Œì¹˜ ìƒì„±
4. ì´ìŠˆ ê´€ë ¨ ë‚´ìš© ì½”ë“œ ìˆ˜ì •
5. add - commit - push
6. feature#ë²ˆí˜¸ -> develop ë¡œ pull request ìƒì„±
7. ì½”ë“œ ë¦¬ë·°
8. develop ë¸Œë Œì¹˜ì— merge í›„ pull request close
9. ì´ìŠˆì— ìˆ˜ì •í•œ ë‚´ìš© ê°„ëµíˆ ì ì€ ë’¤ close
10. feature# ë¸Œë Œì¹˜ ì‚­ì œ
11. ì´ í›„ ì‘ì—…ì€ ë‹¤ë¥¸ ì´ìŠˆ ìƒì„± ë° develop ë¸Œë Œì¹˜ pullí•œ ë’¤ ì‘ì—… ì¬ê°œ
