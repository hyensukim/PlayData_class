# â“ê¸°ë³¸ ì§€ì‹

- CI/CD : ë°°í¬ ìë™í™”
- ë°°í¬ ì‹œì—ëŠ” ë¯¼ê°ì •ë³´ë„ í•¨ê»˜ ì˜¬ë ¤ì•¼í•˜ê¸° ë•Œë¬¸ì—, ì´ë¥¼ ì•”í˜¸í™”í•œ ë’¤ ë°°í¬í•˜ë„ë¡ ì½”ë“œë¥¼ ìˆ˜ì •í•´ì¤˜ì•¼ í•œë‹¤.

# 4. íšŒì›ê°€ì… ë° ì¡°íšŒê¸°ëŠ¥ êµ¬í˜„

íšŒì›ì„œë¹„ìŠ¤ë¥¼ Microserviceë¡œ êµ¬ì„±í•˜ê¸°

ê¸°ëŠ¥ë“¤ì€ ì „ë¶€ postmanìœ¼ë¡œ ì¡°íšŒê°€ ê°€ëŠ¥í•˜ë„ë¡ RestController ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë¨.

## ğŸ‡ ì‹¤ìŠµ ì‹œì‘

1. í”„ë¡œì íŠ¸ ìƒì„±
2. ê²Œì´íŠ¸ì›¨ì´ ë° ìœ ë ˆì¹´ì— ë“±ë¡

##### ìœ ë ˆì¹´ í´ë¼ì´ì–¸íŠ¸ ì„¤ì •

```
eureka:
  client:
    register-with-eureka: true
    fetch-registry: true
    service-url:
      defaultZone: http://127.0.0.1:8761/eureka
  instance:
    instance-id: ${spring.application.name}:${spring.application.instance_id:${random.value}}
```

##### ê²Œì´íŠ¸ì›¨ì´ ì„¤ì •

```
... 
       - id: user-service
          uri: lb://USER-SERVICE
          predicates:
            - Path=/user-service/**
```

##### DBì—°ë™ ë° JPA ì„¤ì •

```
# MySQL ì„¤ì •í•˜ê¸°
spring:
  datasource:
    url: jdbc:mysql://127.0.0.1:3306/DBëª…
		username: ê³„ì • ì´ë¦„
		password: ê³„ì • ë¹„ë°€ë²ˆí˜¸
		driver-class-name: com.mysql.cj.jdbc.Driver

spring:
	jpa:
		hibernate:
			ddl-auto: update
		properties:
			hibernate:
				format_sql: true
		show-sql: true

```

3. RestController ìƒì„± ë° Entity, DTO ìƒì„±

Entityì™€ DTO ê°„ì˜ ì°¨ì´ì ì€ ì—”í‹°í‹°ëŠ” ê¸°ë³¸í‚¤ê°€ í•„ìˆ˜ì´ê³ , DTOëŠ” ìƒê´€ì—†ë‹¤ëŠ” ì ì´ë‹¤.

DTOëŠ” Entity ë‚´ë¶€ ë°ì´í„°ë¥¼ ì€ë‹‰í•˜ê¸° ìœ„í•´ ëŒ€ë¦¬ë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ìœ„í•œ í´ë˜ìŠ¤ì´ë‹¤.

##### RequestCreateUserDto

![DTO ì‚¬ì§„](https://github.com/hyensukim/PlayData_class/blob/main/images/7%EC%9D%BC%EC%B0%A8/DTO%EC%82%AC%EC%A7%84.png?raw=true)

##### ResponseCreateUserDto

![img](https://github.com/hyensukim/PlayData_class/blob/main/images/7%EC%9D%BC%EC%B0%A8/ResponseDTO%20%EC%82%AC%EC%A7%84.png?raw=true)

ìƒì„±ì

```
public ResponseFindUserDto(User user){
        this.userId = user.getUserId();
        this.id = user.getId();
        this.email = user.getEmail();
        this.name = user.getName();
        this.uuid = user.getUuid();
    }
```

##### User.java

![ì—”í‹°í‹° ì‚¬ì§„](https://github.com/hyensukim/PlayData_class/blob/main/images/7%EC%9D%BC%EC%B0%A8/%EC%97%94%ED%8B%B0%ED%8B%B0%20%EC%82%AC%EC%A7%84.png?raw=true)

### ìŠ¤í”„ë§ ë¹ˆ ê²€ì¦

ì‚¬ì§„ë“¤...

- build.gradle ì˜ì¡´ ì¶”ê°€

[Bean Validation ì˜ì¡´ì„±](https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-validation)

- @Valid ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€ - Controller ë©”ì„œë“œ ë§¤ê°œë³€ìˆ˜

@Valid ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš© ì‹œ, í•´ë‹¹ ê°ì²´ê°€ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í†µê³¼í•´ì•¼ë§Œ ë©”ì„œë“œê°€ ì‹¤í–‰ë˜ë„ë¡ í•œë‹¤.

ì§ë ¬í™” : ê°ì²´ -> JSON / ì—­ì§ë ¬í™” : JSON ë°ì´í„° -> ê°ì²´

```
@RestController
public class RestAPIController {

    @RequestMapping("/info")        // @Validê°€ ë¶™ìœ¼ë©´ HumanDTOì— ì—­ì§ë ¬í™” ì „ ìš”êµ¬ëœ ì–‘ì‹ëŒ€ë¡œ ë“¤ì–´ì˜¤ëŠ”ì§€ ì²´í¬í•¨.
    public ResponseEntity<?> getHumanInfo(@Valid @RequestBody HumanDTO humanDTO){
        return ResponseEntity.ok(humanDTO);
    }
}
```

ìœ„ì˜ dPwpdptj @RequestBody ì–´ë…¸í…Œì´ì…˜ê³¼ í•¨ê»˜ ì‚¬ìš©ë˜ì—ˆë‹¤.

@RequestBodyëŠ” HTTP ìš”ì²­ ë³¸ë¬¸ì˜ JSON ë°ì´í„°ë¥¼ ê°ì²´ë¡œ ë°”ì¸ë”© í•´ì¤€ë‹¤.

ë§Œì•½, ìœ íš¨ì„± ê²€ì‚¬ì— ì‹¤íŒ¨í•˜ê²Œ ë˜ë©´ Springì—ì„œ MethodArgumentValidException ì˜ˆì™¸ ë°œìƒì‹œí‚¨ë‹¤.

ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í•˜ë©´, ë°ì´í„° ë¬´ê²°ì„± ë³´ì¥ ë° ì˜ëª»ëœ ë°ì´í„°ì˜ ìœ ì…ì„ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.

- ë§¤ê°œë³€ìˆ˜ë¡œ ë§¤í•‘ë˜ëŠ” DTO í•„ë“œì— ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€í•˜ì—¬ ê²€ì¦

##### ì–´ë…¸í…Œì´ì…˜ ì¢…ë¥˜

| ì–´ë…¸í…Œì´ì…˜                 | ì—­í•  ë° ì„¤ëª…                                                      |
| -------------------------- | ----------------------------------------------------------------- |
| @NotNull                   | ê°’ì´ nullì´ ì•„ë‹Œì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.                                    |
| @NotBlank                  | ê°’ì´ nullì´ ì•„ë‹ˆê³ , ë¹ˆ ë¬¸ìì—´ì´ ì•„ë‹Œì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.                |
| @NotEmpty                  | ê°’ì´ nullì´ ì•„ë‹ˆê³ , ë¹ˆ ë¬¸ìì—´ ë˜ëŠ” ë¹ˆ ì»¬ë ‰ì…˜ì´ ì•„ë‹Œì§€ ê²€ì‚¬í•©ë‹ˆë‹¤. |
| @Size(min, max)            | ê°’ì˜ ê¸¸ì´ê°€ ì£¼ì–´ì§„ ë²”ìœ„ ë‚´ì— ìˆëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.(String)           |
| @Min(value)                | ê°’ì´ ì£¼ì–´ì§„ ìµœì†Ÿê°’ ì´ìƒì¸ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.(Number))                  |
| @Max(value)                | ê°’ì´ ì£¼ì–´ì§„ ìµœëŒ“ê°’ ì´í•˜ì¸ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.(Number))                  |
| @Pattern(regexp)           | ê°’ì´ ì •ê·œ í‘œí˜„ì‹ íŒ¨í„´ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.                    |
| @Email                     | ê°’ì´ ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œ í˜•ì‹ì¸ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.                      |
| @Future                    | ê°’ì´ ë¯¸ë˜ì˜ ì¼ìì¸ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.                                  |
| @Past                      | ê°’ì´ ê³¼ê±°ì˜ ì¼ìì¸ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.                                  |
| @Digits(integer, fraction) | ê°’ì´ ì£¼ì–´ì§„ ì •ìˆ˜ ë° ì†Œìˆ˜ ìë¦¿ìˆ˜ì˜ ìˆ«ìì¸ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.            |
| @AssertTrue                | ê°’ì´ trueì¸ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.                                         |
| @AssertFalse               | ê°’ì´ falseì¸ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.                                        |
| @DecimalMin(value)         | ê°’ì´ ì£¼ì–´ì§„ ìµœì†Ÿê°’ ì´ìƒì¸ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤. (ì†Œìˆ˜ì  í¬í•¨)             |
| @DecimalMax(value)         | ê°’ì´ ì£¼ì–´ì§„ ìµœëŒ“ê°’ ì´í•˜ì¸ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤. (ì†Œìˆ˜ì  í¬í•¨)             |

##### ì •ê·œí‘œí˜„ì‹ ê´€ë ¨ ì°¸ê³  ë§í¬

[ì •ê·œí‘œí˜„ì‹ ì •ë¦¬](https://velog.io/@hyensukim/%EC%A0%95%EA%B7%9C%ED%91%9C%ED%98%84%EC%8B%9D)

### ì„œë¹„ìŠ¤ ë ˆì´ì–´ ë° ë ˆí¬ì§€í† ë¦¬ ë ˆì´ì–´ êµ¬í˜„

##### UserService

```
@Service
@RequiredArgsConstructor
public class UserService {

    private final UserRepository userRepository;

    public void createUser(RequestCreateUserDto userDto){
        User user = userDto.toEntity();
        userRepository.save(user);
    }

    public ResponseFindUserDto findUserByUuid(String uuid){
        User user = userRepository.findUserByUuid(uuid);
        user = Optional.ofNullable(user).orElseThrow(()->{
            throw new RuntimeException("ê°€ì…ë˜ì§€ ì•Šì€ íšŒì›ì…ë‹ˆë‹¤.");
        });
        return new ResponseFindUserDto(user);
    }
}
```

##### UserRepository

```
public interface UserRepository extends JpaRepository<User,Long> {

    User findUserByUuid(String uuid);

}
```

##### UserController

```
@RequestMapping("user-service")
@RestController
@RequiredArgsConstructor
public class UserController {

    private final UserService userService;

    @GetMapping("health-check")
    public String healthCheck(){
        return "server is available";
    }

    /*
        @RequestBody : JSON í˜•íƒœë¡œ ê°’ì„ ë°›ì•„ì˜¬ ë•Œ ì‚¬ìš©.
     */
    @PostMapping("users")
    public ResponseEntity<String> createUser(@Valid @RequestBody RequestCreateUserDto requestCreateUserDto){
        userService.createUser(requestCreateUserDto);
        return ResponseEntity.ok("íšŒì› ê°€ì… ì™„ë£Œ!");
    }

    @GetMapping("users/{uuid}")
    public ResponseEntity<ResponseFindUserDto> getUser(@PathVariable String uuid){
        ResponseFindUserDto user = userService.findUserByUuid(uuid);
        return ResponseEntity.ok(user);
    }

```

### í¬ìŠ¤íŠ¸ë§¨ìœ¼ë¡œ ìš”ì²­ ê²°ê³¼ í™•ì¸

##### GetMappin("health-check")

![img](https://github.com/hyensukim/PlayData_class/blob/main/images/7%EC%9D%BC%EC%B0%A8/%ED%8F%AC%EC%8A%A4%ED%8A%B8%EB%A7%A8-%ED%97%AC%EC%8A%A4%EC%B2%B4%ED%81%AC.png?raw=true)

##### PostMappin("users")

![img](https://github.com/hyensukim/PlayData_class/blob/main/images/7%EC%9D%BC%EC%B0%A8/%ED%8F%AC%EC%8A%A4%ED%8A%B8%EB%A7%A8-%ED%9A%8C%EC%9B%90%EA%B0%80%EC%9E%85.png?raw=true)

##### GetMappin("users/")

![](https://github.com/hyensukim/PlayData_class/blob/main/images/7%EC%9D%BC%EC%B0%A8/%ED%8F%AC%EC%8A%A4%ED%8A%B8%EB%A7%A8-%EA%B0%9C%EB%B3%84%EC%A1%B0%ED%9A%8C.png?raw=true)

### âœ… í…ŒìŠ¤íŠ¸ ì¤‘ì— í™•ì¸í•œ ì 

1. ì‹¤ì œ ì„œë²„ê°€ ì—¬ëŸ¬ê°œê°€ ë™ì‹œì— êµ¬ë™ë˜ë‹¤ ë³´ë‹ˆ, ê²°ê³¼ê°€ ì¶œë ¥ë˜ê¸°ê¹Œì§€ ì‹œê°„ ì§€ì—°ì´ ë°œìƒí•œë‹¤.
